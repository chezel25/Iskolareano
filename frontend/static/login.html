<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scholar Login</title>
<style>
body {
  font-family:'Segoe UI',sans-serif;
  background:#f2f2f2;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.container {
  background:white;
  width:380px;
  padding:2.5rem;
  border-radius:20px;
  box-shadow:0 6px 18px rgba(0,0,0,0.12);
  text-align:center;
}
input {
  width:100%;
  padding:1rem;
  margin-top:1rem;
  border-radius:12px;
  border:1.5px solid #bcbcbc;
}
button {
  width:100%;
  margin-top:1.5rem;
  padding:1rem;
  background:#FF7700;
  color:white;
  border:none;
  border-radius:20px;
  font-size:1.1rem;
  cursor:pointer;
}
a {
  display:block;
  margin-top:1rem;
  text-decoration:none;
  color:#002054;
}
</style>
</head>
<body>

<div class="container">
  <h2>Scholar Login</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button id="loginBtn">Login</button>
  <a href="signup.html">← Don't have an account? Sign up</a>
  <a href="reset-password.html">← Forgot password?</a>
</div>

<!-- Supabase JS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const supabaseClient = supabase.createClient(
  'https://wwzufquuogpshrlrofiv.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind3enVmcXV1b2dwc2hybHJvZml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwNTgxMzcsImV4cCI6MjA4MTYzNDEzN30.JXJgJEpX0BEKYHGbWH1zUq6lVv1jetg0AmEsM-HvZQs'
);

document.getElementById('loginBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();

  if (!email || !password) {
    alert('❌ Enter email and password');
    return;
  }

  try {
    // 1️⃣ Login via Supabase Auth
    const { data, error } = await supabaseClient.auth.signInWithPassword({
      email,
      password
    });

    if (error) {
      alert('❌ ' + error.message);
      return;
    }

    // 2️⃣ Check backend for email_verified
    const res = await fetch('http://localhost:5000/api/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }) // send email+password again
    });

    const result = await res.json();

    if (!res.ok) {
      alert('❌ ' + (result.error || 'Login blocked'));
      await supabaseClient.auth.signOut(); // logout if blocked
      return;
    }

    // ✅ Login success
    localStorage.setItem('user', JSON.stringify(result.user));
    localStorage.setItem('access_token', result.session.access_token);

    alert('✅ Login successful');
    window.location.href = 'applicant.html';

  } catch (err) {
    console.error(err);
    alert('❌ Server error');
  }
});
</script>

</body>
</html>
