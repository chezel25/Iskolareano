<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
/>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: #eef2ff;
  color: #111827;
}

/* LAYOUT */
.container {
  max-width: 1200px;
  margin: 30px auto;
  padding: 20px;
}

/* HEADER */
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.header h1 {
  margin: 0;
}

.logout {
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background: white;
  cursor: pointer;
}

/* NAV STICKERS */
.nav {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 16px;
  margin-bottom: 30px;
}

.nav-card {
  background: white;
  border-radius: 16px;
  padding: 18px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  box-shadow: 0 6px 15px rgba(0,0,0,0.06);
  transition: transform .15s ease;
}

.nav-card:hover {
  transform: translateY(-3px);
}

.nav-icon {
  font-size: 28px;
  background: #eef2ff;
  padding: 12px;
  border-radius: 12px;
}

.nav-text {
  font-weight: 600;
}

/* CONTENT CARD */
.card {
  background: white;
  border-radius: 18px;
  padding: 22px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.06);
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th {
  text-align: left;
  font-size: 13px;
  color: #6b7280;
  padding-bottom: 10px;
}

td {
  padding: 14px 0;
  border-top: 1px solid #e5e7eb;
}

/* BADGES */
.badge {
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
}

.pending { background:#fde68a; color:#92400e; }
.approved { background:#bbf7d0; color:#065f46; }
.rejected { background:#fecaca; color:#7f1d1d; }

/* BUTTONS */
button {
  padding: 6px 12px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
}

.approve { background:#111827; color:white; }
.reject { background:#dc2626; color:white; }

/* INPUTS */
input, textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
}
.nav {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 16px;
  margin-bottom: 30px;
}

/* All nav cards share same style */
.nav-card {
 
  color: rgb(9, 1, 1);
  border-radius: 14px;
  padding: 16px 18px;
  display: flex;
  align-items: center;
  gap: 14px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(11, 46, 127, 0.05);
  transition: all .2s ease;
  position: relative;
  text-decoration: none; /* remove underline for <a> */
}

.nav-card:hover {
  background: #eb8125; /* lighter blue on hover */
  transform: translateY(-2px);
}



/* Text inside card */
.nav-text {
  font-weight: 600;
  font-size: 15px;
}

/* Ensure <a> inherits nav-card styles */
a.nav-card {
  display: flex;
  color: inherit; /* remove link color */
  text-decoration: none; /* remove underline */
}


</style>
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <div class="header">
     <h1>Admin Dashboard</h1>

  <div style="display:flex; gap:10px; align-items:center;">
    <button onclick="loadPendingAdmins()">Pending Approvals</button>
<div id="pendingList"></div>


    <button class="logout" onclick="location.href='admin-login.html'">
      Logout
    </button>
  </div>
</div>

  <div class="nav">
  <!-- Applicants redirect to another file -->
   <a href="admin-applicant.html" class="nav-card">
    <div class="nav-indicator"></div>
    <div class="nav-text">Applicants</div>
  </a>
  <!-- Other cards stay on current page -->
  <div class="nav-card" onclick="loadScholars()">
    <div class="nav-indicator"></div>
    <div class="nav-text">Scholars</div>
  </div>

  <div class="nav-card" onclick="showAnnouncements()">
    <div class="nav-indicator"></div>
    <div class="nav-text">Announcements</div>
  </div>

  <div class="nav-card" onclick="showGraduates()">
    <div class="nav-indicator"></div>
    <div class="nav-text">Graduates</div>
  </div>

  <div class="nav-card" onclick="showCreateScholarForm()">
    <div class="nav-indicator"></div>
    <div class="nav-text">Create Scholar</div>
  </div>
</div>

<!-- Content area -->
<div id="content" class="card">
  <p>Select an option above to manage the system.</p>
</div>



<!-- KEEP YOUR EXISTING JS (UNCHANGED LOGIC) -->

<script>

//CREATE SCHOLAR FORM
  function showCreateScholarForm() {
  const html = `
    <h3>Create Scholar Account</h3>
    <input id="first_name" placeholder="First Name"><br>
<input id="middle_name" placeholder="Middle Name"><br>
<input id="last_name" placeholder="Last Name"><br>
<input id="address" placeholder="Address"><br>
<input id="email" placeholder="Email"><br>
<input id="degree" placeholder="Degree"><br>
<button onclick="createScholar()">Create Scholar</button>
  `;
  document.getElementById('content').innerHTML = html;
}

async function createScholar() {
  const first_name = document.getElementById('first_name').value;
  const middle_name = document.getElementById('middle_name').value;
  const last_name = document.getElementById('last_name').value;
  const address = document.getElementById('address').value;
  const email = document.getElementById('email').value;
  const degree = document.getElementById('degree').value;

  console.log("Sending request:", { first_name, middle_name, last_name, address, email, degree });

  const res = await fetch('http://localhost:5000/api/admin/create-scholar', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ first_name, middle_name, last_name, address, email, degree })
  });

  const data = await res.json();
  console.log("Response:", data);

  if (res.ok) {
    alert("✅ Scholar account created. Check email for temporary password.");
  } else {
    alert("❌ Error: " + data.error);
  }
}
async function loadApplicants() {
  const res = await fetch('http://localhost:5000/api/admin/applicants');
  const data = await res.json();

  let html = "<h3>Applicants</h3><table border='1'><tr><th>Full Name</th><th>Email</th><th>Degree</th></tr>";

  data.forEach(a => {
    html += `<tr>
      <td>${a.full_name || ''}</td>
      <td>${a.email || ''}</td>
      <td>${a.degree || '-'}</td>
    </tr>`;
  });

  html += "</table>";
  document.getElementById('content').innerHTML = html;
}

async function loadScholars() {
  try {
    const res = await fetch('http://localhost:5000/api/admin/scholars');
    const data = await res.json();

    let html = "<h3>Current Scholars</h3><table border='1'><tr><th>Scholar ID</th><th>Full Name</th><th>Email</th><th>Degree</th></tr>";

    data.forEach(s => {
      html += `<tr>
        <td>${s.scholar_id || '-'}</td>
        <td>${s.full_name || '-'}</td>
        <td>${s.email || '-'}</td>
        <td>${s.degree || '-'}</td>
      </tr>`;
    });

    html += "</table>";
    document.getElementById('content').innerHTML = html;

  } catch (err) {
    console.error(err);
    alert("Failed to load scholars.");
  }
}
//-------------------------------FOR NOTIFICATION-----------------------//
async function loadPendingAdmins() {
  try {
    const res = await fetch('http://localhost:5000/api/admin/pending-approvals');
    if (!res.ok) throw new Error('Failed to load pending admins');
    const pending = await res.json();

    document.getElementById('pendingList').innerHTML = pending.length === 0
      ? "<p>No pending approvals</p>"
      : pending.map(a => `
          <li>
            ${a.first_name} ${a.last_name} (${a.role}) - ${a.email}
            <button onclick="approveAdmin('${a.id}')">Approve</button>
            <button onclick="rejectAdmin('${a.id}')">Reject</button>
          </li>
        `).join('');

    // Update red badge
    document.getElementById('notifCount').textContent = pending.length;

  } catch (err) {
    console.error(err);
    alert('Failed to load pending admins');
  }
}


//-------------------------------------------------------------
async function showAnnouncements() {
  const res = await fetch('http://localhost:5000/api/announcements');
  const data = await res.json();
  let html = `
    <h3>Manage Announcements</h3>
    <input id="title" placeholder="Title"><br>
    <textarea id="contentInput" placeholder="Write announcement..."></textarea><br>
    <button onclick="postAnnouncement()">Post</button>
    <hr>
    <h4>Existing Announcements:</h4>
    <ul>`;
  data.forEach(a => {
    html += `<li>
      <b>${a.title}</b> (${a.date})<br>${a.content}
      <button onclick="deleteAnnouncement(${a.id})">Delete</button>
    </li><hr>`;
  });
  html += "</ul>";
  document.getElementById('content').innerHTML = html;
}

async function postAnnouncement() {
  await fetch('http://localhost:5000/api/admin/announcement', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      title: document.getElementById('title').value,
      content: document.getElementById('contentInput').value
    })
  });
  alert("Announcement posted!");
  showAnnouncements();
}

async function deleteAnnouncement(id) {
  if (confirm("Delete this announcement?")) {
    await fetch(`http://localhost:5000/api/admin/announcement/${id}`, { method: 'DELETE' });
    showAnnouncements();
  }
}

// Graduates management
async function showGraduates() {
  const res = await fetch('http://localhost:5000/api/graduates');
  const data = await res.json();
  let html = `
    <h3>Graduated Scholars</h3>
    <form id="graduateForm" enctype="multipart/form-data">
      <input id="g_name" placeholder="Full Name"><br>
      <input id="g_degree" placeholder="Degree"><br>
      <input id="g_year" placeholder="Year Graduated"><br>
      <textarea id="g_message" placeholder="Farewell Message"></textarea><br>
      <input type="file" id="g_photo"><br>
      <button type="button" onclick="addGraduate()">Add Graduate</button>
    </form>
    <hr><h4>List of Graduates</h4>
  `;
  data.forEach(g => {
    html += `
      <div style="border:1px solid #aaa; padding:10px; margin:10px;">
        ${g.photo ? `<img src="http://localhost:5000/uploads/${g.photo}" width="100"><br>` : ''}
        <b>${g.name}</b> (${g.degree}, ${g.year})<br>
        <i>"${g.message}"</i><br>
        <button onclick="deleteGraduate(${g.id})">Delete</button>
      </div>`;
  });
  document.getElementById('content').innerHTML = html;
}

async function addGraduate() {
  const formData = new FormData();
  formData.append('name', g_name.value);
  formData.append('degree', g_degree.value);
  formData.append('year', g_year.value);
  formData.append('message', g_message.value);
  if(g_photo.files[0]) formData.append('photo', g_photo.files[0]);

  await fetch('http://localhost:5000/api/admin/graduate', {
    method: 'POST',
    body: formData
  });
  alert("Graduate added!");
  showGraduates();
}

async function deleteGraduate(id) {
  if (confirm("Remove this graduate?")) {
    await fetch(`http://localhost:5000/api/admin/graduate/${id}`, { method: 'DELETE' });
    showGraduates();
  }
  
}
</script>
</body>
</html>